<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>SemSched</title>
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-title" content="SemSched">
  <link rel="manifest" href="site.webmanifest">
  <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans+SC:ital,wght@0,100;0,300;0,400;0,500;0,700;0,800;0,900;1,100;1,300;1,400;1,500;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <style>
@font-face {font-family: s; src: url(fa-solid-900.woff2);}
@font-face {font-family: b; src: url(fa-brands-400.woff2);}

::selection {color: #fff; background: #596e79;}
html {position: relative;}
@keyframes fade-in {0% {opacity: 0;}}
body {color: #212529; font-weight: 300;
  font-family: 'Alegreya Sans SC', system-ui; min-height: calc(100dvh - 2.5em);
  padding-bottom: 2.5em; margin: 0 .75em; display: flex; flex-flow: column;
  justify-content: center; animation: .75s cubic-bezier(.75,0,.75,.9) fade-in;}
@media (width>=36em) {body {width: 32.25em; margin-inline: auto;}}
@media (width>=48em) {body {width: 43.5em;}}
@media (width>=62em) {body {width: 58.5em;}}

a {-webkit-tap-highlight-color: #0000; outline: 0;}
a:not(:focus-visible,:hover) {text-decoration: none;}
p, h2 {line-height: 1.5;}
.ib {font-size: inherit; line-height: 1.5; font-family: inherit;
  padding: .625em .75em; border: .0625em solid; border-radius: .5em;}
.i {color: inherit; font-weight: inherit; width: 100%; border-color: #bec3c9;
  box-sizing: border-box; transition: border-color .15s;}
.i:focus {border-color: #596e79; outline: 0;}
button {-webkit-tap-highlight-color: #0000;}

h1 {text-align: center;}
h1>a {color: #596e79;}
h1+p {text-align: justify;}
h1+p>b {font-style: italic; font-weight: inherit;}
code {background: #f8f9fa; font-family: inherit; padding-inline: .1875em;
  border-radius: .25em;}

form {margin-bottom: 1em; display: grid; gap: .625em;}
label:has(>span) {position: relative;}
label>span {color: #6c757d; text-overflow: ellipsis; white-space: nowrap;
  max-width: calc(100% - 1.625em); padding-inline: .25em; overflow: hidden;
  position: absolute; transform-origin: 0; translate: .5625em -50%;
  transition: color .15s, background .15s, top .15s, translate .15s, scale .15s;
  -webkit-user-select: none; user-select: none; pointer-events: none;}
label>span:not(.lu) {top: 50%;}
span.lu {background: var(--g,#fff); top: 0; translate: .625em -50%; scale: .75;}
label:has(>input:focus)>span {color: #596e79; font-weight: 400;}

.d {box-shadow: .3em .3em .3em #0003; font-size: .9em; line-height: 1.7361;
  max-width: min(25em,calc(100% - 3.2639em - 26px));
  padding: .8333em .5556em .8333em 2.7083em; border: .069445em solid #bec3c9;
  outline: 0; border-radius: .5em; z-index: 1; translate: 0 1.770834em;}
.d::before {position: absolute; left: .5556em;}
.d0::before {content: '!'; color: #fff; background: #ff8c00; font-weight: 700;
  text-align: center; width: 1.7361em; border-radius: .25em;}
.d1::before {content: '\f058'; color: #596e79; font-family: s; scale: 1.7361;
  transform-origin: 0;}

.b {color: #fff; background: #596e79; border-color: #0000;
  transition: background .15s;}
.b:focus-visible {outline: .1875em solid;}
.b:enabled:hover {background: #647b87;}
.b:enabled:active {background: #4e606a;}
.b::before {content: '\2b'; font-family: s; vertical-align: bottom;}
.bs::before {content: '\f00c';}
@media (width>=36em) {form {grid-template-columns: 1fr 1fr;}
  .b {grid-column: 1/-1;}}

:has(>table) {overflow: auto; margin-bottom: 1em;}
table {border-spacing: 0; width: 100%; border: .0625em solid #bec3c9;
  border-radius: 1em;}
th, td {text-align: center; padding: .625em;}
th {font-weight: 500;}
tbody>:nth-child(n+2)>* {border-top: .0625em solid #bec3c9;}
td {text-align: center; white-space: nowrap;}

:is(table,p+label) .i {appearance: textfield; text-align: center; width: 3em;
  aspect-ratio: 1.618034; padding: 0;}
:is(table,p+label) .i::-webkit-inner-spin-button {display: none;}

.be, .bd {background: 0; padding: .375em .75em; border-color: #0000;
  transition: color .15s, background .15s;}
.be {color: #596e79;}
.be:focus-visible {outline: .0625em solid #647b87;}
.be:hover {color: #fff; background: #596e79;}
.be:active {color: #fff; background: #4e606a;}
.be::before {content: '\f044'; font-family: s;}
.bd {color: #dc3545;}
.bd:focus-visible {outline: .0625em solid #e15361;}
.bd:hover {color: #fff; background: #dc3545;}
.bd:active {color: #fff; background: #a52834;}
.bd::before {content: '\f1f8'; font-family: s;}

[type=checkbox] {width: 1.25em; height: 1.25em; margin: 0 .25em .1875em 0;
  vertical-align: middle; accent-color: #596e79;}

h2 {font-size: 1.25em; margin-block: 0; display: inline-block;}
h2+p {margin-top: 0; display: inline-block;}
p+label {width: fit-content; display: block;}

template+p+ol {padding-left: 0; list-style: none;}
ol tr>:nth-child(n+2) {border-left: .0625em solid #bec3c9;}

footer {margin-block: .25em; display: flex; flex-flow: wrap;
  justify-content: center; align-items: center; position: absolute;
  inset: auto 0 0;}
footer>ul {list-style: none; padding-left: 0; margin-block: 0; display: flex;}
footer a {color: inherit; line-height: 2em; font-family: b; text-align: center;
  width: 2em; display: block;}
footer ::before {vertical-align: bottom;}
footer [href$=com]::before {content: 'AY'; font-size: .75em;}
footer [href*=github]::before {content: '\f09b';}
footer [href*=linkedin]::before {content: '\f08c';}
footer [href*=wa]::before {content: '\f232';}
footer>small {color: #000; padding-inline: .6em;}

.l {background: #fff8; width: 100vw; height: 100vh; position: fixed; top: 0;
  left: 0; z-index: 2;}
.l>img {width: 20em; position: absolute; top: 50%; left: 50%;
  translate: -50% -50%;}
  </style>
</head>
<body>
  <header>
    <h1><a href="#">SemSched</a></h1>
    <p>
      Planning next semester? Add your course sections/groups and <strong>rank them by priority</strong>. You'll see schedules with the <b>fewest days</b> (if you need every course), or schedules with the <b>most credits/courses</b>.<br>
      Edit the example: <span>MATH 101-02 (3) — 25,26,55,56</span>. (<code>25 = row 2, col 5</code>)
    </p>
  </header>
  <main>
    <form>
      <label><span>Course</span>
        <input name="c" class="ib i">
      </label>
      <label><span>Section</span>
        <input name="s" class="ib i">
      </label>
      <label><span>Credits</span>
        <input type="number" name="u" min=".5" max="8" step=".5" class="ib i">
      </label>
      <label><span>Periods</span>
        <input name="P" class="ib i">
      </label>
      <dialog class="d d0"></dialog>
      <button class="ib b">&nbsp;Add</button>
    </form>
    <div><table><tbody></tbody></table></div>
    <div>
      <h2>Courses:</h2>
      <p></p>
      <label>Need first <input type="number" class="ib i"></label>
      <template>
        <li><table><tbody>
          <tr><td></td><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
          <tr><th>1</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>2</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>3</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>4</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>5</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>6</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>7</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        </tbody></table></li>
      </template>
      <p></p>
      <ol></ol>
    </div>
  </main>
  <footer>
    <ul>
      <li><a href="https://ahmadyascene.com" target="_blank"></a></li>
      <li><a href="https://github.com/ahmadyascene" target="_blank"></a></li>
      <li><a href="https://linkedin.com/in/ahmadyascene" target="_blank"></a></li>
      <li><a href="https://wa.me/+201063582917" target="_blank"></a></li>
    </ul>
    <small>&copy; 2025 Ahmad Yascene</small>
  </footer>
  <div class="l"><img src="loading.gif" alt="Loading..."></div>
  <script>
'use strict';
const f=document.forms[0], d=f.querySelector('dialog'),
  b=f.querySelector('button'), t=document.querySelector('tbody'),
  ni=document.querySelector('p+label>.i'),
  T=document.querySelector('template').content,
  ol=document.querySelector('template+p+ol'), l=document.querySelector('.l'),
  I=JSON.parse(localStorage.getItem('I'))||[
    // {c:'A',P:['11','12','41','42'],u:3,s:'1'},
    // {c:'A',P:['13','14','43','44'],u:3,s:'2'},
    // {c:'A',P:['15','16','45','46'],u:3,s:'3'},
    // {c:'A',P:['17','18','47','48'],u:3,s:'4'},
    // {c:'A',P:['21','22','51','52'],u:3,s:'5'},
    // {c:'A',P:['23','24','53','54'],u:3,s:'6'},
    // {c:'A',P:['25','26','55','56'],u:3,s:'7'},
    // {c:'A',P:['27','28','57','58'],u:3,s:'8'},
    // {c:'A',P:['31','32','61','62'],u:3,s:'9'},
    // {c:'A',P:['33','34','63','64'],u:3,s:'10'},
    // {c:'A',P:['35','36','65','66'],u:3,s:'11'},
    // {c:'A',P:['37','38','67','68'],u:3,s:'12'},
    // {c:'A',P:['71','72','73','74'],u:3,s:'13'},
    // {c:'A',P:['75','76','77','78'],u:3,s:'14'},
    // {c:'B',P:['11','12','41','42'],u:3,s:'1'},
    // {c:'B',P:['13','14','43','44'],u:3,s:'2'},
    // {c:'B',P:['15','16','45','46'],u:3,s:'3'},
    // {c:'B',P:['17','18','47','48'],u:3,s:'4'},
    // {c:'B',P:['21','22','51','52'],u:3,s:'5'},
    // {c:'B',P:['23','24','53','54'],u:3,s:'6'},
    // {c:'B',P:['25','26','55','56'],u:3,s:'7'},
    // {c:'B',P:['27','28','57','58'],u:3,s:'8'},
    // {c:'B',P:['31','32','61','62'],u:3,s:'9'},
    // {c:'B',P:['33','34','63','64'],u:3,s:'10'},
    // {c:'B',P:['35','36','65','66'],u:3,s:'11'},
    // {c:'B',P:['37','38','67','68'],u:3,s:'12'},
    // {c:'B',P:['71','72','73','74'],u:3,s:'13'},
    // {c:'B',P:['75','76','77','78'],u:3,s:'14'},
    // {c:'C',P:['11','12','41','42'],u:3,s:'1'},
    // {c:'C',P:['13','14','43','44'],u:3,s:'2'},
    // {c:'C',P:['15','16','45','46'],u:3,s:'3'},
    // {c:'C',P:['17','18','47','48'],u:3,s:'4'},
    // {c:'C',P:['21','22','51','52'],u:3,s:'5'},
    // {c:'C',P:['23','24','53','54'],u:3,s:'6'},
    // {c:'C',P:['25','26','55','56'],u:3,s:'7'},
    // {c:'C',P:['27','28','57','58'],u:3,s:'8'},
    // {c:'C',P:['31','32','61','62'],u:3,s:'9'},
    // {c:'C',P:['33','34','63','64'],u:3,s:'10'},
    // {c:'C',P:['35','36','65','66'],u:3,s:'11'},
    // {c:'C',P:['37','38','67','68'],u:3,s:'12'},
    // {c:'C',P:['71','72','73','74'],u:3,s:'13'},
    // {c:'C',P:['75','76','77','78'],u:3,s:'14'},
    // {c:'D',P:['11','12','41','42'],u:3,s:'1'},
    // {c:'D',P:['13','14','43','44'],u:3,s:'2'},
    // {c:'E',P:['15','16','45','46'],u:3,s:'3'},
    // {c:'E',P:['17','18','47','48'],u:3,s:'4'},
    // {c:'F',P:['21','22','51','52'],u:3,s:'5'},
    // {c:'F',P:['23','24','53','54'],u:3,s:'6'},
    // {c:'G',P:['25','26','55','56'],u:3,s:'7'},
    // {c:'G',P:['27','28','57','58'],u:3,s:'8'},
    // {c:'H',P:['31','32','61','62'],u:3,s:'9'},
    // {c:'H',P:['33','34','63','64'],u:3,s:'10'},
    // {c:'I',P:['35','36','65','66'],u:3,s:'11'},
    // {c:'I',P:['37','38','67','68'],u:3,s:'12'},
    // {c:'J',P:['71','72','73','74'],u:3,s:'13'},
    // {c:'J',P:['75','76','77','78'],u:3,s:'14'},
    // {c:'K',P:['11','12','41','42'],u:3,s:'1'},
    // {c:'L',P:['13','14','43','44'],u:3,s:'2'},
    // {c:'M',P:['15','16','45','46'],u:3,s:'3'},
    // {c:'N',P:['17','18','47','48'],u:3,s:'4'},
    // {c:'O',P:['21','22','51','52'],u:3,s:'5'},
    // {c:'P',P:['23','24','53','54'],u:3,s:'6'},
    // {c:'Q',P:['25','26','55','56'],u:3,s:'7'},
    // {c:'R',P:['27','28','57','58'],u:3,s:'8'},
    // {c:'S',P:['31','32','61','62'],u:3,s:'9'},
    // {c:'T',P:['33','34','63','64'],u:3,s:'10'},
    // {c:'K',P:['11','12','41','42'],u:3,s:'01'},
    // {c:'L',P:['13','14','43','44'],u:3,s:'02'},
    // {c:'M',P:['15','16','45','46'],u:3,s:'03'},
    // {c:'N',P:['17','18','47','48'],u:3,s:'04'},
    // {c:'O',P:['21','22','51','52'],u:3,s:'05'},
    // {c:'P',P:['23','24','53','54'],u:3,s:'06'},
    // {c:'Q',P:['25','26','55','56'],u:3,s:'07'},
    // {c:'R',P:['27','28','57','58'],u:3,s:'08'},
    // {c:'S',P:['31','32','61','62'],u:3,s:'09'},
    // {c:'T',P:['33','34','63','64'],u:3,s:'010'},
    // {c:'U',P:['35','36','65','66'],u:3,s:'11'},
    // {c:'V',P:['37','38','67','68'],u:3,s:'12'},
    // {c:'W',P:['71','72','73','74'],u:3,s:'13'},
    // {c:'X',P:['75','76','77','78'],u:3,s:'14'},
    // {c:'Y',P:['31','32','33','34','35','36','37'],u:3,s:'13'},
    // {c:'Z',P:['18','28','38','48','58','68','78'],u:3,s:'14'},
    // {c:'a',P:['11','21','31','41','51','61','71'],u:3,s:'15'},
    // {c:'b',P:['12','22','32','42','52','62','72'],u:3,s:'16'},
    // {c:'c',P:['13','23','33','43','53','63','73'],u:3,s:'17'},
    // {c:'d',P:['14','24','34','44','54','64','74'],u:3,s:'18'},
    // {c:'e',P:['15','25','35','45','55','65','75'],u:3,s:'19'},
    // {c:'f',P:['16','26','36','46','56','66','76'],u:3,s:'20'},
    // {c:'g',P:['17','27','37','47','57','67','77'],u:3,s:'21'},
    // {c:'h',P:['11','21','31','41','51','61','71'],u:3,s:'15'},
    // {c:'i',P:['12','22','32','42','52','62','72'],u:3,s:'16'},
    // {c:'j',P:['13','23','33','43','53','63','73'],u:3,s:'17'},
    // {c:'k',P:['14','24','34','44','54','64','74'],u:3,s:'18'},
    // {c:'l',P:['15','25','35','45','55','65','75'],u:3,s:'19'},
    // {c:'m',P:['16','26','36','46','56','66','76'],u:3,s:'20'},
    // {c:'n',P:['17','27','37','47','57','67','77'],u:3,s:'21'},
    {c:'MATH 101',P:['25','26','55','56'],u:3,s:'02'},
    // {c:'MATH 101',P:['44','45','74','75'],u:3,s:'01'},
    // {c:'MATH 101',P:['14','15','44','45'],u:3,s:'03'},
    // {c:'MATH 101',P:['24','25','54','55'],u:3,s:'04'},
    // {c:'Physics',P:['31','32','61','62'],u:3,s:'1'},
    // {c:'Physics',P:['33','34','63','64'],u:3,s:'2'},
    // {c:'Physics',P:['35','36','65','66'],u:3,s:'3'},
    // {c:'Physics',P:['37','38','67','68'],u:3,s:'4'},
    // {c:'Biology',P:['32','33','62','63'],u:3,s:'02'},
    // {c:'Biology',P:['42','43','72','73'],u:3,s:'01'},
    // {c:'Biology',P:['12','13','42','43'],u:3,s:'03'},
    // {c:'Biology',P:['22','23','52','53'],u:3,s:'04'},
    // {c:'MTE 211',P:['15','16','45','46'],u:2,s:'61'},
    // {c:'MTE 211',P:['17','18','47','48'],u:2,s:'62'},
    // {c:'MTE 226',P:['21','22','23','51','52','53'],u:3,s:'61'},
    // {c:'MTE 226',P:['21','22','23','51','52','53'],u:3,s:'62'},
    // {c:'MTE 226',P:['24','25','26','54','55','56'],u:3,s:'63'},
    // {c:'MTE 156',P:['11','12','13','41','42'],u:3,s:'61'},
    // {c:'MTE 156',P:['21','22','23','51','52'],u:3,s:'62'},
    // {c:'MTE 156',P:['24','25','53','54','55'],u:3,s:'63'},
    // {c:'ENG 172',P:['11','12','41','42'],u:2,s:'61'},
    // {c:'ENG 172',P:['13','14','43','44'],u:2,s:'62'},
    // {c:'ENG 172',P:['15','16','45','46'],u:2,s:'63'},
    // {c:'MTE 250',P:['31','32','33','34','35','36','37'],u:3,s:'1'},
    // {c:'MTE 250',P:['18','28','36','37','38','48','58'],u:3,s:'2'},
    // {c:'MTE 213',P:['13','14','43','44'],u:2,s:'61'},
    // {c:'MTE 213',P:['23','24','53','54'],u:2,s:'62'},
    // {c:'MTE 213',P:['25','26','55','56'],u:2,s:'63'},
    // {c:'MTE 244',P:['14','15','16'],u:1,s:'61'},
    // {c:'MTE 244',P:['21','22','23'],u:1,s:'62'},
    // {c:'MTE 244',P:['24','25','26'],u:1,s:'63'},
    // {c:'MTE 244',P:['51','52','53'],u:1,s:'64'},
    // {c:'MTE 244',P:['54','55','56'],u:1,s:'65'},
    // {c:'ENG 173',P:['13','14','43','44'],u:2,s:'61'},
    // {c:'ENG 173',P:['21','22','51','52'],u:2,s:'62'},
    // {c:'MTE 251',P:['17','18','47','48'],u:2,s:''},
    // {c:'MTE 241',P:['14','15','16'],u:2,s:''},
    // {c:'MNG 201',P:['11','12','13'],u:2,s:'21'},
    // {c:'MNG 201',P:['15','16','17'],u:2,s:'22'},
    // {c:'MNG 201',P:['21','22','23'],u:2,s:'23'},
    // {c:'MNG 201',P:['25','26','27'],u:2,s:'24'},
    // {c:'MNG 201',P:['31','32','33'],u:2,s:'25'},
    // {c:'MNG 201',P:['35','36','37'],u:2,s:'26'},
    // {c:'MNG 201',P:['41','42','43'],u:2,s:'27'},
    // {c:'MNG 201',P:['45','46','47'],u:2,s:'28'},
    // {c:'MNG 201',P:['51','52','53'],u:2,s:'29'},
    // {c:'MNG 201',P:['55','56','57'],u:2,s:'30'},
    // {c:'MEC 256',P:['11','12','41','42'],u:3,s:'21'},
    // {c:'MEC 256',P:['13','14','43','44'],u:3,s:'22'},
    // {c:'MEC 256',P:['17','18','47','48'],u:3,s:'23'},
    // {c:'ENG 277',P:['31','32','33','34'],u:3,s:'61'},
    // {c:'ENG 277',P:['35','36','37','38'],u:3,s:'62'}
  ],
  cd=r=>{const D=[];
    for (const {P} of r.slice(1)) for (const [d] of P)
      if (!D.includes(d)) D.push(d);
    return D.length;},
  render=d=>{
    if (!I.length) {
      l.hidden=ol.parentElement.hidden=t.parentElement.parentElement.hidden=true;
      return;}
    let rows=''; t.parentElement.parentElement.hidden=false;
    for (const [i,{d,c,P,u,s}] of I.entries()) rows+=`<tr>
      <td><input type=number value=${i+1} ${d?'disabled':''} class="ib i" data-i=${i}></td>
      <td>${c}${s?'-'+s:''} (${u}) — ${P}</td>
      <td><button data-i=${i} class="ib b${d?'d">&nbsp;Delete':'e">&nbsp;Edit'}</button></td>
      <td><label><input type=checkbox ${d?'':'checked'} data-i=${i}>&nbsp;Selected</label></td>
    </tr>`;
    t.innerHTML=rows;
    for (const i of t.querySelectorAll('.i')) i.onchange=()=>{
      if (i.value==='') {i.value=+i.dataset.i+1; return;}
      const v=parseInt(i.value);
      I.splice(v>0?v-1:v<-1?v+1:v==-1?I.length:0,0,I.splice(i.dataset.i,1)[0]);
      uI();};
    for (const d of t.querySelectorAll('[type=checkbox]')) d.onchange=()=>{
      I[d.dataset.i].d=!d.checked; uI();};

    if (d) return;
    const eI=I.filter(({d})=>!d), C=[], S=[], L=[[]], R=[], O=[];
    if (!eI.length) {l.hidden=ol.parentElement.hidden=true; return;}
    if (eI.length>40) {const CN=[]; let N=1;
      If:for (const {c} of eI) {//(c.toLowerCase()==cn.c.toLowerCase()
        for (const cn of CN) if (c==cn.c) {cn.n++; continue If;}
        CN.push({c,n:1});}
      for (const {n} of CN) N*=n;
      if (N>2e6) {const C=[]; for (const {c} of CN) C.push(c);
        ol.parentElement.firstElementChild.textContent=`Courses (${CN.length}):`;
        ni.parentElement.previousElementSibling.textContent=C.join(', ');
        N=N.toString();
        for (let i=N.length-3; i>0; i-=3) N=N.slice(0,i)+' '+N.slice(i);
        ol.previousElementSibling.hidden=false;
        ol.previousElementSibling.textContent=`Too many combinations (${N}) — deselect some sections`;
        ol.textContent=''; l.hidden=true; return;}}
    ol.parentElement.hidden=false; ol.previousElementSibling.hidden=true;
    ni.value=n; l.hidden=eI.length/n**.05<30;
    setTimeout(()=>{
      for (const cs of eI) {
        if (C.includes(cs.c)) {for (const l of L
      .filter(l=>{for (const {c,s} of l) if (cs.c==c) return S[C.indexOf(cs.c)]==s;}))
          for (let i=l.length-1; i>-1; i--) if (cs.c==l[i].c) {
            const nl=l.toSpliced(i,1); nl.push(cs); L.push(nl); break;};}
        else {C.push(cs.c); S.push(cs.s); for (const l of L) l.push(cs);}}
//       eIf:for (const cs of eI) {
//         for (const [i,c] of C.entries()) if (cs.c.toLowerCase()==c.toLowerCase()) {
//           for (const l of L
// .filter(l=>{for (const {c,s} of l) if (cs.c.toLowerCase()==c.toLowerCase()) return S[i]==s;}))
//             for (let i=l.length-1; i>-1; i--) if (cs.c.toLowerCase()==l[i].c.toLowerCase()) {
//               const nl=l.toSpliced(i,1); nl.push(cs); L.push(nl); break;};
//           continue eIf;}
//         C.push(cs.c); S.push(cs.s); for (const l of L) l.push(cs);}
      ol.parentElement.firstElementChild.textContent=`Courses (${C.length}):`;
      ni.parentElement.previousElementSibling.textContent=C.join(', ');
      Lf:for (const l of L) {const r=[]; let U=0;
        lf:for (const cs of l) {
          for (const p of cs.P) for (const {P} of r) if (P.includes(p))
            if (C.slice(0,n).includes(cs.c)) continue Lf; else continue lf;
          r.push(cs);}
        for (const {u} of r) U+=u; r.unshift(U); R.push(r);}
      if (R.length)
        if (n<C.length) {R.sort((a,b)=>(b.length-1)*b[0]-(a.length-1)*a[0]);
          const w=(R[0].length-1)*R[0][0];
          Rf:for (const r of R) {if ((r.length-1)*r[0]!=w) break;
            Of:for (const o of O) {
              rf:for (const rcs of r.slice(1)) {
                for (const ocs of o.slice(r.indexOf(rcs)))
                  //(rcs.c.toLowerCase()==ocs.c.toLowerCase()&&rcs.s==ocs.s)
                  if (rcs.c==ocs.c&&rcs.s==ocs.s) continue rf;
                continue Of;}
              continue Rf;}
            O.push(r); if (O.length>499) break;}}
        else {R.sort((a,b)=>cd(a)-cd(b)); const w=cd(R[0]);
          for (const r of R) {if (cd(r)!=w) break; O.push(r);}}
      else {ol.previousElementSibling.hidden=false;
        ol.previousElementSibling.textContent='No possible schedules — decrease the "Need first" value';};

      ol.textContent='';
      for (const o of O) {
        const t=T.cloneNode(true),
          rows=t.firstElementChild.firstElementChild.firstElementChild.children;
        rows[0].children[0].textContent=o[0]+'/'+(o.length-1);
        for (const {c,P,u,s} of o.slice(1)) {let fp, lp; for (const p of P) {
          if (p-lp==1||p-lp==9*p[0]+'1') {
            rows[p[0]].children[p.slice(1)].hidden=true;
            rows[fp[0]].children[fp[1]].colSpan++;}
          else {fp=p;
            rows[p[0]].children[p.slice(1)].textContent=c+(s?'-'+s:'')+' ('+u+')';}
          lp=p;}}
        ol.appendChild(t);}
      l.hidden=true;});},
  uI=d=>{localStorage.setItem('I',JSON.stringify(I)); i=I.length; f.reset();
    for (const e of f.elements) if (e!=b) e.previousElementSibling.className='';
    b.classList.remove('bs'); b.textContent=' Add'; render(d);},
  m=(m,b=0)=>{d.className='d d'+b; d.textContent=m; clearTimeout(to); d.show();
    to=setTimeout(()=>d.close(),4000);};
let to, i=I.length, n=ni.value=localStorage.getItem('n')||1;

render();

setTimeout(()=>{for (const i of document.querySelectorAll('label>span+.i')) {
  if (i.value) i.previousElementSibling.className='lu';
  i.oninput=()=>{i.previousElementSibling.className='lu'; //firefox
    /* if (i==_) {f(); _.oninput=f;} else */ i.oninput=null;};
  i.onfocus=()=>i.previousElementSibling.className='lu';
  i.onblur=()=>{if (!i.value&&!i.matches(':focus'))
    i.previousElementSibling.className='';};}},225/*chrome*/);

f.onsubmit=e=>{e.preventDefault();
  const c=f.c.value.trim(), P=f.P.value.replaceAll(' ',''), s=f.s.value.trim();
//c.toLowerCase()==cs.c.toLowerCase()&&s.toLowerCase()==cs.s.toLowerCase()
  for (const cs of I) if (c==cs.c&&s==cs.s&&i!=I.indexOf(cs)) {
    m('Already added'); f.s.focus(); return;}
  if (!/^[1-7](?:[1-9]|10)(?:,+[1-7](?:[1-9]|10))*$/.test(P)) {m(`Enter cell codes, comma-separated (see example above)`); f.P.focus(); return;}
  m(i==I.length?'Added':'Saved',1);
  I.splice(i,1,{c,P:[...new Set(P.split(/,+/))].sort((a,b)=>
    a[0]*10+Number(a.slice(1))-b[0]*10-b.slice(1)),u:Number(f.u.value)||3,s});
  uI();};

f.c.onchange=()=>{for (const {c,u} of I) if (f.c.value.trim()==c) {
  f.u.value=u; f.u.previousElementSibling.className='lu'; return;}};

t.onclick=({target})=>{
  if (target.classList.contains('be')) {i=target.dataset.i;
    for (const e of f.elements) if (e!=b) {e.value=I[i][e.name];
      e.previousElementSibling.className='lu';}
    f.c.focus(); b.classList.add('bs'); b.textContent=' Save';}
  else if (target.classList.contains('bd')) {I.splice(target.dataset.i,1);
    uI(1);}};

ni.onchange=()=>{if (!+ni.value) {ni.value=n; return;}
  localStorage.setItem('n',n=Math.ceil(Math.abs(ni.value)));
  render();};
  </script>
</body>
</html>
