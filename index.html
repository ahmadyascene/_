<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>SemSched</title>
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-title" content="SemSched">
  <link rel="manifest" href="site.webmanifest">
  <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans+SC:ital,wght@0,100;0,300;0,400;0,500;0,700;0,800;0,900;1,100;1,300;1,400;1,500;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <style>
@font-face {font-family: s; src: url(fa-solid-900.woff2);}
@font-face {font-family: b; src: url(fa-brands-400.woff2);}

::selection {color: #fff; background: #596e79;}
html {position: relative;}
@keyframes fade-in {0% {opacity: 0;}}
body {color: #212529; font-weight: 300;
  font-family: 'Alegreya Sans SC', system-ui; min-height: calc(100dvh - 2.5em);
  padding-bottom: 2.5em; margin: 0 .75em; display: flex; flex-flow: column;
  justify-content: center; animation: .75s cubic-bezier(.75,0,.75,.9) fade-in;}
@media (width>=36em) {body {width: 32.25em; margin-inline: auto;}}
@media (width>=48em) {body {width: 43.5em;}}
@media (width>=62em) {body {width: 58.5em;}}

a {-webkit-tap-highlight-color: #0000; outline: 0;}
p, h2 {line-height: 1.5;}
.ib {font-size: inherit; line-height: 1.5; font-family: inherit;
  padding: .625em 1.5em; border: .0625em solid; border-radius: 1.5em;}
.i {color: inherit; font-weight: inherit; width: 100%; border-color: #bec3c9;
  box-sizing: border-box; transition: border-color .15s;}
.i:focus {border-color: #596e79; outline: 0;}
button {-webkit-tap-highlight-color: #0000;}

h1 {font-size: 2.25em; width: fit-content; margin-inline: auto;
  position: relative;}
h1::before {content: ''; background: #f7f3ee; height: 21.5%;
  border-radius: 0 0 .15em .15em; position: absolute; inset-inline: 0;
  bottom: 12%; z-index: -1; transition: height .15s;}
h1:has(>:focus-visible,>:hover)::before {height: 38.5%;}
header a {text-decoration: none;}
h1>a {color: #596e79; display: block;}

h1+p {text-align: justify;}
@keyframes b {50% {opacity: 0;}}
.ty::after {content: ''; border-left: .0625em solid; border-radius: .04em;
  margin-left: .1em; animation: .7s ease-in-out infinite b;} 
.ty+a {opacity: 0;}

h1+p>a {color: inherit; font-weight: 500; vertical-align: middle;
  display: inline-flex; align-items: center; position: relative;
  transition: opacity .15s cubic-bezier(.75,0,.75,.9), color .15s;}
@keyframes flash {50%, 63% {color: inherit;} 51.5%, 61.5% {color: #596e79;}}
h1+p>a:not(:focus-visible,:hover) {animation: 10s linear infinite flash;}
h1+p>a:is(:focus-visible,:hover) {color: #596e79;}
h1+p>a::before {content: '';
  background: linear-gradient(90deg,#596e79 50%,#0000 50%); width: 1.75em;
  aspect-ratio: 1; border-radius: 50%;}
h1+p>a::after {content: '\f04b'; background: #f7f3ee; font: .5em/2.5 s;
  text-align: center; width: 2.5em; border-radius: 50%; position: absolute;
  left: .5em;}

form {padding: 1em .625em; border: .0625em solid #bec3c9; border-radius: 1em;
  margin-bottom: 1em; display: grid; gap: .625em; position: relative;}
label:has(>span) {position: relative;}
label>span {color: #6c757d; text-overflow: ellipsis; white-space: nowrap;
  max-width: calc(100% - 1.625em); padding-inline: .375em; overflow: hidden;
  position: absolute; transform-origin: 0; translate: 1.1875em -50%;
  transition: color .15s, background .15s, top .15s, translate .15s, scale .15s;
  -webkit-user-select: none; user-select: none; pointer-events: none;}
label>span:not(.lu) {top: 50%;}
span.lu {background: #fff; top: 0; translate: 1.28125em -50%; scale: .75;}
label:has(>input:focus)>span {color: #596e79; font-weight: 400;}

.d {box-shadow: .3em .3em .3em #0003; font-size: .9em; line-height: 1.7361;
  max-width: min(25em,calc(100% - 3.2639em - 22px));
  padding: .8333em .5556em .8333em 2.7083em; border: .069445em solid #bec3c9;
  outline: 0; border-radius: .9em; top: 40%; z-index: 1; translate: 0 -50%;}
.d::before {position: absolute; left: .5556em;}
.d0::before {content: '!'; color: #fff; background: #ff8c00; font-weight: 700;
  text-align: center; width: 1.7361em; border-radius: .25em;}
.d1::before {content: '\f058'; color: #596e79; font-family: s; scale: 1.7361;
  transform-origin: 0;}

.b {color: #fff; background: #596e79; border-color: #0000;
  transition: background .15s;}
.b:focus-visible {outline: .125em solid #596e79; outline-offset: -.0625em;}
.b:enabled:hover {background: #647b87;}
.b:enabled:active {background: #4e606a;}
.b::before {content: '\2b'; font-family: s; vertical-align: bottom;}
.bs::before {content: '\f00c';}
@media (width>=36em) {form {grid-template-columns: 1fr 1fr;}
  .d {top: 33.333333%;}
  .b {grid-column: 1/-1;}}

:has(>table) {overflow: auto; margin-bottom: 1em;}
table {border-spacing: 0; width: 100%; border: .0625em solid #bec3c9;
  border-radius: 1em;}
th, td {text-align: center; padding: .625em;}
th {font-weight: 500;}
tbody>:nth-child(n+2)>* {border-top: .0625em solid #bec3c9;}
td {text-align: center; white-space: nowrap;}

:is(table,p+label) .i {appearance: textfield; line-height: 1; text-align: center;
  width: 2.75em; aspect-ratio: 1.618034; padding: 0;}
:is(table,p+label) .i::-webkit-inner-spin-button {display: none;}
table .i:disabled {background: #efefef4d;}

.be, .bd {background: 0; padding: .375em 1em; border-color: #0000;
  transition: color .15s, background .15s;}
.be {color: #596e79;}
.be:focus-visible {outline: .0625em solid #647b87;}
.be:hover {color: #fff; background: #596e79;}
.be:active {color: #fff; background: #4e606a;}
.be::before {content: '\f044'; font-family: s;}
.bd {color: #dc3545;}
.bd:focus-visible {outline: .0625em solid #e15361;}
.bd:hover {color: #fff; background: #dc3545;}
.bd:active {color: #fff; background: #a52834;}
.bd::before {content: '\f1f8'; font-family: s;}

[type=checkbox] {accent-color: #596e79; vertical-align: middle; width: 1.2em;
  height: 1.2em; margin: 0 .25em .1875em 0;}
[type=checkbox]:focus-visible {outline: .075em solid #647b87;
  outline-offset: .15em;}

h2 {font-weight: 500; font-size: 1.125em; margin-block: 0; display: inline-block;}
h2+p {margin-top: 0; display: inline-block;}
p~label {width: fit-content; display: block;}
p+label {margin-bottom: 1em;}
select {background: 0; font-weight: inherit; font-size: inherit;
  font-family: inherit; padding: .25em; border: .0625em solid #bec3c9;
  border-radius: 1em; transition: border-color .15s;}
select:focus-visible {border-color: #596e79; outline: 0;}
option {font-weight: inherit;}

template+p+ol {padding-left: 0; list-style: none;}
ol tr>:nth-child(n+2) {border-left: .0625em solid #bec3c9;}

footer {margin-block: .25em; display: flex; flex-flow: wrap;
  justify-content: center; align-items: center; position: absolute;
  inset: auto 0 0;}
footer>ul {list-style: none; padding-left: 0; margin-block: 0; display: flex;}
footer a {color: inherit; line-height: 2em; font-family: b; text-align: center;
  width: 2em; display: block;}
footer a:not(:focus-visible,:hover) {text-decoration: none;}
footer ::before {vertical-align: bottom;}
footer [href$=com]::before {content: 'AY'; font-size: .75em;}
footer [href*=github]::before {content: '\f09b';}
footer [href*=linkedin]::before {content: '\f08c';}
footer [href*=wa]::before {content: '\f232';}
footer>small {color: #000; padding-inline: .6em;}

[src="loading.gif"] {width: 20em; position: fixed; top: 50%; left: 50%;
  z-index: -1; translate: -50% -50%;}
  </style>
</head>
<body>
  <header>
    <h1><a href="#">SemSched</a></h1>
    <p>
      <span>Finds schedules with the fewest days or the most credits/courses for the sections you enter.</span>
      <a href="SemSched video.mp4">Demo</a>
    </p>
  </header>
  <main>
    <form>
      <label><span>Course</span>
        <input name="c" class="ib i">
      </label>
      <label><span>Section</span>
        <input name="s" class="ib i">
      </label>
      <label><span>Credits</span>
        <input type="number" name="u" min="0" max="10" step=".5" class="ib i">
      </label>
      <label><span>Periods</span>
        <input name="P" class="ib i">
      </label>
      <dialog class="d d0"></dialog>
      <button class="ib b">&nbsp;Add</button>
    </form>
    <div><table><tbody></tbody></table></div>
    <div>
      <h2>Courses:</h2>
      <p></p>
      <label>Require first <input type="number" class="ib i"></label>
      <label>Schedules with <select>
        <option>most credits/courses</option>
        <option>fewest days</option>
      </select></label>
      <template>
        <li><table><tbody>
          <tr><td></td><th>P1</th><th>P2</th><th>P3</th><th>P4</th><th>P5</th><th>P6</th><th>P7</th><th>P8</th><th>P9</th><th>P10</th></tr>
          <tr><th>D1</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D2</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D3</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D4</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D5</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D6</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
          <tr><th>D7</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        </tbody></table></li>
      </template>
      <p></p>
      <ol></ol>
    </div>
  </main>
  <footer>
    <ul>
      <li><a href="https://ahmadyascene.com" target="_blank"></a></li>
      <li><a href="https://github.com/ahmadyascene" target="_blank"></a></li>
      <li><a href="https://linkedin.com/in/ahmadyascene" target="_blank"></a></li>
      <li><a href="https://wa.me/+201063582917" target="_blank"></a></li>
    </ul>
    <small>&copy; 2025 Ahmad Yascene</small>
  </footer>
  <img src="loading.gif" alt="Loading...">
  <script>
'use strict';
const ty=document.querySelector('h1+p>span'), tyt=ty.textContent,
  f=document.forms[0], d=f.querySelector('dialog'),
  b=f.querySelector('button'), t=document.querySelector('tbody'),
  n=document.querySelector('p+label>.i'),
  dl=document.querySelector('select'),
  T=document.querySelector('template').content,
  ol=document.querySelector('template+p+ol'),
  l=document.querySelector('[src="loading.gif"]'),
  cS=JSON.parse(localStorage.getItem('cS'))||[],
  render=skip=>{
    if (!cS.length) {
      l.hidden=ol.parentElement.hidden=t.parentElement.parentElement.hidden=true;
      return;}
    if (skip!='in') {
      let rows=''; for (const [i,{d,c,s,u,P}] of cS.entries()) rows+=`<tr>
        <td><input type=number value=${i+1} ${d?'disabled':''} class="ib i" data-i=${i}></td>
        <td>${c}${s?'-'+s:''} (${u}) — ${P}</td>
        <td><button data-i=${i} class="ib b${d?'d">&nbsp;Delete':'e">&nbsp;Edit'}</button></td>
        <td><label><input type=checkbox ${d?'':'checked'} data-i=${i}>&nbsp;Selected</label></td>
      </tr>`;
      t.parentElement.parentElement.hidden=false; t.innerHTML=rows;
      for (const i of t.querySelectorAll('.i')) i.onchange=()=>{
        if (i.value==='') {i.value=+i.dataset.i+1; return;}
        const v=parseInt(i.value), cs=cS.splice(i.dataset.i,1)[0], C=[];
        cS.splice(v>0?v-1:v<-1?v+1:v==-1?cS.length:0,0,cs);
        for (const {c,s} of cS) if (!C.includes(c)&&(c!=cs.c||s==cs.s)) C.push(c);
        cS.sort((a,b)=>C.indexOf(a.c)-C.indexOf(b.c)); ucS();};
      for (const e of t.querySelectorAll('[type=checkbox]')) e.onchange=()=>{
        cS[e.dataset.i].d=!e.checked; ucS();};}

    if (skip=='out') return;
    const ecS=cS.filter(({d})=>!d), C=[], S=[], O=[];
    if (!ecS.length) {l.hidden=ol.parentElement.hidden=true; return;}
    for (const cs of ecS)
      if (cs.c==C.at(-1)) S.at(-1).push(cs); else {C.push(cs.c); S.push([cs]);}
    ol.parentElement.firstElementChild.textContent=`Courses (${C.length}):`;
    n.parentElement.previousElementSibling.textContent=C.join(', ');
    n.value=localStorage.getItem('n')||1;
    dl.value=localStorage.getItem('dl')||'most credits/courses';
    if (ecS.length>48) {let N=1; for (const s of S) N*=s.length;
      if (N>44e6) {N=N.toString();
        for (let i=N.length-3; i>0; i-=3) N=N.slice(0,i)+' '+N.slice(i);
        ol.previousElementSibling.hidden=false;
        ol.previousElementSibling.textContent=`Too many combinations (${N}) — deselect some sections`;
        ol.textContent=''; l.hidden=true; return;}}
    ol.previousElementSibling.hidden=true; ol.parentElement.hidden=false;
    l.hidden=ecS.length/n.value**.05<30;
    w?.terminate(); w=new Worker('w.js'); w.postMessage([S,C,n.value,dl.value]);
    w.onmessage=({data:L})=>{
      if (L[0].length==1) {ol.previousElementSibling.hidden=false;
        ol.previousElementSibling.textContent='No possible schedules';
        L.length=0;}
      else R:for (const r of
        dl.value=='fewest days'?L.sort((a,b)=>b.length-a.length):L) {
        O:for (const o of O) {
          r:for (let i=1; i<r.length; i++) {
            for (let j=i; j<o.length; j++)
              if (r[i].c==o[j].c&&r[i].s==o[j].s) continue r;
            continue O;}
          continue R;}
        O.push(r); if (O.length>99) break;}

      ol.textContent='';
      for (const o of O) {
        const t=T.cloneNode(true),
          rows=t.firstElementChild.firstElementChild.firstElementChild.children;
        rows[0].children[0].textContent=o[0]+'/'+(o.length-1);
        for (const {c,s,u,P} of o.slice(1)) {let fp, lp; for (const p of P) {
          if (p-lp==1||p-lp==9*p[0]+'1') {
            rows[p[0]].children[p.slice(1)].hidden=true;
            rows[fp[0]].children[fp[1]].colSpan++;}
          else {fp=p;
            rows[p[0]].children[p.slice(1)].textContent=c+(s?'-'+s:'')+' ('+u+')';}
          lp=p;}}
        ol.appendChild(t);}
      l.hidden=true;};},
  ucS=skip=>{localStorage.setItem('cS',JSON.stringify(cS)); i=cS.length; f.reset();
    for (const e of f.elements) if (e!=b) e.previousElementSibling.className='';
    b.classList.remove('bs'); b.textContent=' Add'; render(skip);},
  m=(m,b=0)=>{d.className='d d'+b; d.textContent=m; clearTimeout(dt); d.show();
    dt=setTimeout(()=>d.close(),4000);};
let dt, i=cS.length, w;

if (!cS.length) {let i=0; ty.className='ty';
  const I=setInterval(()=>{ty.textContent=tyt.slice(0,i);
    if (i++==tyt.length) {clearInterval(I); ty.className='';}},50);}
render();

setTimeout(()=>{for (const i of document.querySelectorAll('label>span+.i')) {
  if (i.value) i.previousElementSibling.className='lu';
  i.oninput=()=>{i.previousElementSibling.className='lu'; //firefox
    /* if (i==_) {f(); _.oninput=f;} else */ i.oninput=null;};
  i.onfocus=()=>i.previousElementSibling.className='lu';
  i.onblur=()=>{if (!i.value&&!i.matches(':focus'))
    i.previousElementSibling.className='';};}},225/*chrome*/);

f.onsubmit=e=>{e.preventDefault();
  const cs={c:f.c.value.trim(),s:f.s.value.trim(),u:+(f.u.value||3),
    P:f.P.value.replace(/[ DPdp]|^,+|,+$/g,'')};
  if (!cs.c) {m('Course required'); f.c.focus(); return;}
  for (const e of cS) if (cs.c==e.c&&cs.s==e.s&&i!=cS.indexOf(e)) {
    m('Already added'); f.s.focus(); return;}
  if (!/^[1-7](?:[1-9]|10)(?:,+[1-7](?:[1-9]|10))*$/.test(cs.P)) {
    m(`<day><period>, comma-separated — see demo`); f.P.focus(); return;}
  cs.P=[...new Set(cs.P.split(/,+/))]
    .sort((a,b)=>a[0]*10+(+a.slice(1))-b[0]*10-b.slice(1));
  if (i==cS.length) {
    for (let j=cS.length;j;) if (cs.c==cS[--j].c) {cS.splice(j+1,0,cs); break;}
    if (i==cS.length) cS.push(cs); m('Added',1);}
  else {cS.splice(i,1,cs); m('Saved',1);}
  ucS();};

f.c.onchange=()=>{for (const {c,u} of cS) if (f.c.value.trim()==c) {
  f.u.value=u; f.u.previousElementSibling.className='lu'; return;}};

t.onclick=({target})=>{
  if (target.classList.contains('be')) {i=target.dataset.i;
    for (const e of f.elements) if (e!=b) {e.value=cS[i][e.name];
      e.previousElementSibling.className='lu';}
    f.c.focus(); b.classList.add('bs'); b.textContent=' Save';}
  else if (target.classList.contains('bd')) {cS.splice(target.dataset.i,1);
    ucS('out');}};

n.onchange=()=>{if (!+n.value) {n.value=localStorage.getItem('n')||1; return;}
  localStorage.setItem('n',Math.ceil(Math.abs(n.value)));
  render();};

dl.onchange=()=>{localStorage.setItem('dl',dl.value); render('in');};
  </script>
</body>
</html>
